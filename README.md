# Blog Lite - REST API блог-платформа

## Описание проекта

Blog Lite - это REST-сервис блог-платформы, разработанный на Django и Django REST Framework (DRF) в соответствии с техническим заданием. Проект демонстрирует навыки работы с массовым созданием записей, управлением связанными объектами и выполнением атомарных операций.

## Ключевые функции

### 1. Модели данных

#### Post (Пост)
- `id` - Первичный ключ
- `title` - Заголовок поста (макс. 200 символов)
- `body` - Содержимое поста (текстовое поле)
- `author` - Автор поста (связь с User)
- `created_at` - Дата создания (автоматически)
- `updated_at` - Дата обновления (автоматически)
- `views_count` - Счетчик просмотров (по умолчанию 0)

#### SubPost (Под-пост)
- `id` - Первичный ключ
- `title` - Заголовок под-поста (макс. 200 символов)
- `body` - Содержимое под-поста (текстовое поле)
- `post` - Связь с основным постом
- `created_at` - Дата создания (автоматически)
- `updated_at` - Дата обновления (автоматически)

#### Like (Лайк)
- `id` - Первичный ключ
- `post` - Связь с постом
- `user` - Пользователь, поставивший лайк
- `created_at` - Дата создания (автоматически)
- Уникальность по полям (post, user)

### 2. API Эндпойнты

#### Посты (Posts)
- `GET /api/posts/` - Список постов с пагинацией (20 постов на страницу)
- `POST /api/posts/` - Создать пост (с возможностью добавления под-постов)
- `GET /api/posts/{id}/` - Детали поста
- `PUT /api/posts/{id}/` - Полное обновление поста
- `PATCH /api/posts/{id}/` - Частичное обновление поста
- `DELETE /api/posts/{id}/` - Удалить пост
- `POST /api/posts/bulk/` - Массовое создание постов
- `POST /api/posts/{id}/like/` - Лайкнуть/убрать лайк
- `GET /api/posts/{id}/view/` - Увеличить счетчик просмотров

#### Под-посты (SubPosts)
- `GET /api/subposts/` - Список всех под-постов
- `POST /api/subposts/` - Создать под-пост
- `GET /api/subposts/{id}/` - Детали под-поста
- `PUT /api/subposts/{id}/` - Обновить под-пост
- `DELETE /api/subposts/{id}/` - Удалить под-пост

### 3. Специальные возможности

#### Массовое создание постов
```json
POST /api/posts/bulk/
{
  "posts": [
    {
      "title": "Пост 1",
      "body": "Содержимое поста 1",
      "subposts": [
        {"title": "Под-пост 1.1", "body": "Содержимое под-поста 1.1"}
      ]
    },
    {
      "title": "Пост 2", 
      "body": "Содержимое поста 2"
    }
  ]
}
```

#### Управление под-постами через основной пост
При создании или обновлении поста можно:
- Создавать новые под-посты
- Обновлять существующие (передавая id)
- Удалять под-посты (не включая их в список)

```json
PUT /api/posts/1/
{
  "title": "Обновленный пост",
  "body": "Обновленное содержимое",
  "subposts": [
    {
      "id": 1,
      "title": "Обновленный под-пост",
      "body": "Обновленное содержимое"
    },
    {
      "title": "Новый под-пост",
      "body": "Содержимое нового под-поста"
    }
  ]
}
```

#### Система лайков
- Повторное нажатие убирает лайк
- Защита от дублирования лайков на уровне БД
- Атомарные операции для подсчета лайков

#### Безопасный инкремент просмотров
- Использование `F()` выражений Django для атомарных операций
- Безопасность при параллельных запросах

## Технические характеристики

### Стек технологий
- **Python 3.11+**
- **Django 5.2.3**
- **Django REST Framework 3.16.0**
- **PostgreSQL** (в продакшене)
- **SQLite** (для разработки)
- **Docker & Docker Compose**

### Зависимости
```
Django>=5.2.3
djangorestframework>=3.14.0
drf-spectacular>=0.27.0
django-cors-headers>=4.0.0
psycopg2-binary>=2.9.5
coverage>=7.0.0
ruff>=0.1.0
```

### Качество кода
- **Линтинг**: Ruff с настройками PEP8
- **Форматирование**: Ruff format (совместимо с Black)
- **Тестирование**: Покрытие тестами 70%+
- **Документация**: Swagger/OpenAPI через drf-spectacular

## Установка и запуск

### Локальная разработка

1. **Клонирование и настройка окружения**
```bash
git clone <repository-url>
cd blog_project
python -m venv .venv
.venv\Scripts\activate  # Windows
pip install -r requirements.txt
```

2. **Настройка базы данных**
```bash
python manage.py makemigrations
python manage.py migrate
python manage.py createsuperuser
```

3. **Запуск сервера**
```bash
python manage.py runserver
```

### Docker

1. **Сборка и запуск**
```bash
docker-compose up --build
```

2. **Остановка**
```bash
docker-compose down
```

## Тестирование

### Запуск тестов
```bash
python manage.py test
```

### Тесты с покрытием
```bash
coverage run --source='.' manage.py test
coverage report --show-missing
coverage html
```

### Проверка качества кода
```bash
ruff check .
ruff format --check .
```

## API Документация

После запуска сервера документация доступна по адресам:
- **Swagger UI**: http://localhost:8000/api/schema/swagger-ui/
- **ReDoc**: http://localhost:8000/api/schema/redoc/
- **OpenAPI Schema**: http://localhost:8000/api/schema/

## Структура проекта

```
blog_project/
├── blog/                      # Основное приложение
│   ├── models.py             # Модели данных
│   ├── serializers.py        # DRF сериализаторы
│   ├── api_views.py          # API представления
│   ├── api_urls.py           # API маршруты
│   ├── admin.py              # Админ-панель
│   └── tests.py              # Тесты
├── blog_project/             # Настройки проекта
│   ├── settings.py           # Настройки Django
│   └── urls.py               # Основные маршруты
├── .github/workflows/        # CI/CD конфигурация
├── Dockerfile                # Docker образ
├── docker-compose.yml        # Docker Compose
├── pyproject.toml           # Конфигурация Ruff
├── requirements.txt         # Python зависимости
└── README.md               # Документация проекта
```

### Файловая структура тестов

Тесты покрывают следующие аспекты:
- **Модели**: Создание, валидация, методы
- **API**: CRUD операции, массовые операции
- **Под-посты**: Управление через основные посты
- **Лайки**: Защита от дублирования
- **Просмотры**: Атомарность инкремента
- **Пагинация**: Корректность разбивки на страницы

## CI/CD

### GitHub Actions
Автоматический pipeline включает:
1. **Линтинг**: Проверка кода с Ruff
2. **Форматирование**: Проверка стиля кода
3. **Тестирование**: Запуск всех тестов с PostgreSQL
4. **Покрытие**: Генерация отчета о покрытии
5. **Docker**: Проверка сборки образа

### Конфигурация окружения

#### Переменные окружения
- `DB_NAME` - Имя базы данных (по умолчанию: blog_lite)
- `DB_USER` - Пользователь БД (по умолчанию: postgres)
- `DB_PASSWORD` - Пароль БД (по умолчанию: postgres)
- `DB_HOST` - Хост БД (по умолчанию: localhost)
- `DB_PORT` - Порт БД (по умолчанию: 5432)

## Примеры использования API

### Создание поста с под-постами
```bash
curl -X POST http://localhost:8000/api/posts/ \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Мой первый пост",
    "body": "Содержимое поста",
    "subposts": [
      {
        "title": "Первый под-пост",
        "body": "Содержимое первого под-поста"
      }
    ]
  }'
```

### Массовое создание постов
```bash
curl -X POST http://localhost:8000/api/posts/bulk/ \
  -H "Content-Type: application/json" \
  -d '{
    "posts": [
      {"title": "Пост 1", "body": "Содержимое 1"},
      {"title": "Пост 2", "body": "Содержимое 2"}
    ]
  }'
```

### Лайк поста
```bash
curl -X POST http://localhost:8000/api/posts/1/like/
```

### Просмотр поста
```bash
curl -X GET http://localhost:8000/api/posts/1/view/
```

## Мониторинг и логирование

### Логи Django
Все логи выводятся в консоль с уровнем INFO.

### Метрики производительности
- Использование `prefetch_related` и `select_related` для оптимизации запросов
- Атомарные операции для критических секций
- Пагинация для больших списков

## Безопасность

### Аутентификация
- Session Authentication для веб-интерфейса
- Basic Authentication для API
- Права доступа: IsAuthenticatedOrReadOnly

### Валидация данных
- Валидация на уровне сериализаторов
- Ограничения на уровне БД (unique constraints)
- Санитизация пользовательского ввода

## Развертывание

### Продакшн настройки
1. Установите переменные окружения для БД
2. Используйте PostgreSQL вместо SQLite
3. Настройте ALLOWED_HOSTS
4. Установите DEBUG=False
5. Настройте статические файлы

### Docker в продакшене
```bash
docker-compose -f docker-compose.prod.yml up -d
```

## Участие в разработке

### Стиль кода
- Следуйте PEP8
- Используйте Ruff для линтинга
- Покрывайте новый код тестами
- Обновляйте документацию

### Процесс разработки
1. Создайте feature-ветку
2. Внесите изменения
3. Добавьте тесты
4. Проверьте линтинг: `ruff check .`
5. Запустите тесты: `python manage.py test`
6. Создайте Pull Request

## Лицензия

Проект разработан в учебных целях согласно техническому заданию "Blog Lite".

## Контакты

Для вопросов по проекту создавайте Issues в репозитории.

---

*Последнее обновление: Август 2025*
